<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sumobot Monitor - Bloques</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-black text-green-400 min-h-screen flex flex-col items-center justify-center font-mono">

<h1 class="text-2xl mb-4">ü§ñ Sumobot Monitor</h1>

<p id="status" class="text-red-400 mb-4">Desconectado</p>

<button id="connectBtn" class="bg-indigo-600 text-white px-6 py-3 rounded-lg mb-4">
Conectar BLE
</button>

<div id="log" class="bg-gray-900 w-96 h-48 p-4 overflow-y-auto rounded-lg text-sm mb-4">
Esperando datos...
</div>

<h2 class="text-lg mb-2">Secuencia IA recibida:</h2>
<textarea id="iaSequence" class="w-96 h-24 p-2 mb-4 bg-gray-800 text-white rounded" readonly></textarea>

<button id="executeBtn" class="bg-green-600 text-white px-6 py-2 rounded-lg mb-4">
Ejecutar Secuencia IA
</button>

<div id="blocksArea" class="bg-gray-900 w-96 h-32 p-4 overflow-y-auto rounded-lg text-sm">
<!-- Aqu√≠ el usuario podr√≠a agregar bloques o secuencias personalizadas -->
Secuencia personalizada: F,L,R,F
</div>

<script>
const UART_SERVICE = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
const UART_RX = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';

let characteristic;

document.getElementById("connectBtn").onclick = async () => {
    const device = await navigator.bluetooth.requestDevice({
        filters: [{ services: [UART_SERVICE] }]
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(UART_SERVICE);
    characteristic = await service.getCharacteristic(UART_RX);

    await characteristic.startNotifications();
    characteristic.addEventListener('characteristicvaluechanged', handleData);

    document.getElementById("status").textContent = "Conectado a " + device.name;
    document.getElementById("status").className = "text-green-400 mb-4";
};

function handleData(event) {
    const value = new TextDecoder().decode(event.target.value).trim();
    const logDiv = document.getElementById("log");
    const iaText = document.getElementById("iaSequence");

    logDiv.innerHTML += "<div>> " + value + "</div>";
    logDiv.scrollTop = logDiv.scrollHeight;

    // Guardar √∫ltima secuencia IA recibida
    iaText.value = value;
}

// Simula ejecuci√≥n de la secuencia
document.getElementById("executeBtn").onclick = () => {
    const seq = document.getElementById("iaSequence").value;
    if(seq){
        alert("Ejecutando secuencia IA: " + seq + "\n(En el robot real se usar√≠a la funci√≥n execute)");
    }
};
</script>

</body>
</html>
